// Lifefit - Database Entity Relationship Diagram
// Generated from Django Models

// ==================== ACCOUNTS ====================
Table accounts_user {
  id int [pk, increment]
  email varchar(255) [unique, not null]
  first_name varchar(150) [not null]
  last_name varchar(150) [not null]
  password varchar(255) [not null]
  role varchar(20) [not null, note: "super_admin, gym_admin, coach, athlete"]
  is_active bool [default: true]
  is_staff bool [default: false]
  is_superuser bool [default: false]
  date_joined datetime [default: "current_timestamp"]
  gym_id int [null, ref: > gyms_gym.id]
  puntos int [default: 0]
  nivel int [default: 1]
  google_id varchar(255) [null]
  google_picture varchar(max)
  is_google_account bool [default: false]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    email
    gym_id
    role
  }
}

// ==================== GYMS ====================
Table gyms_gym {
  id int [pk, increment]
  name varchar(255) [not null]
  slug varchar(255) [unique, not null]
  description text
  location varchar(255)
  status varchar(20) [default: "active", note: "active, inactive"]
  brand_color varchar(7)
  website varchar(max)
  contact_email varchar(255)
  metrics json
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    slug
    status
  }
}

Table gyms_branch {
  id int [pk, increment]
  gym_id int [not null, ref: > gyms_gym.id]
  name varchar(255) [not null]
  slug varchar(255) [not null]
  address varchar(255) [not null]
  city varchar(120)
  state varchar(120)
  country varchar(120)
  zipcode varchar(20)
  status varchar(20) [default: "active", note: "active, inactive"]
  phone varchar(30)
  latitude decimal(9,6)
  longitude decimal(9,6)
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    (gym_id, slug)
    status
  }
}

// ==================== WORKOUTS ====================
Table workouts_exercise {
  id int [pk, increment]
  gym_id int [null, ref: > gyms_gym.id]
  name varchar(255) [not null]
  category varchar(20) [note: "strength, cardio, mobility, flexibility, hiit"]
  equipment varchar(255)
  muscle_group varchar(255)
  description text
  media_url varchar(max)
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    (gym_id, name)
    category
  }
}

Table workouts_workoutroutine {
  id int [pk, increment]
  gym_id int [null, ref: > gyms_gym.id]
  name varchar(255) [not null]
  objective text
  level varchar(20) [default: "beginner", note: "beginner, intermediate, advanced"]
  duration_minutes int [default: 30]
  status varchar(20) [default: "draft", note: "draft, published, archived"]
  points_reward int [default: 0]
  created_by int [null, ref: > accounts_user.id]
  is_public bool [default: false]
  notes text
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    gym_id
    status
    created_by
  }
}

Table workouts_routineexercise {
  id int [pk, increment]
  routine_id int [not null, ref: > workouts_workoutroutine.id]
  exercise_id int [not null, ref: > workouts_exercise.id]
  order int [default: 1]
  sets int [default: 3]
  reps int [default: 10]
  rest_seconds int [default: 60]
  tempo varchar(50)
  weight_kg decimal(6,2)
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    (routine_id, order, exercise_id)
  }
}

Table workouts_workoutsession {
  id int [pk, increment]
  user_id int [not null, ref: > accounts_user.id]
  gym_id int [null, ref: > gyms_gym.id]
  routine_id int [null, ref: > workouts_workoutroutine.id]
  performed_at datetime [not null]
  duration_minutes int [default: 30]
  perceived_exertion int [default: 5]
  completion_percentage decimal(5,2) [default: 0]
  notes text
  status varchar(20) [default: "planned", note: "planned, completed, skipped"]
  points_awarded int [default: 0]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    user_id
    gym_id
    routine_id
    performed_at
  }
}

// ==================== NUTRITION ====================
Table nutrition_nutritionplan {
  id int [pk, increment]
  gym_id int [null, ref: > gyms_gym.id]
  name varchar(255) [not null]
  description text
  calories_per_day int [default: 2000]
  protein_g int [default: 150]
  carbs_g int [default: 200]
  fats_g int [default: 65]
  duration_days int [default: 7]
  status varchar(20) [default: "draft", note: "draft, active, archived"]
  points_reward int [default: 0]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    gym_id
    status
  }
}

Table nutrition_mealtemplate {
  id int [pk, increment]
  plan_id int [not null, ref: > nutrition_nutritionplan.id]
  day_number int [not null]
  meal_type varchar(20) [not null, note: "breakfast, lunch, dinner, snack"]
  name varchar(255) [not null]
  description text
  calories int [default: 0]
  protein_g int [default: 0]
  carbs_g int [default: 0]
  fats_g int [default: 0]
  ingredients text
  instructions text
  order int [default: 1]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    (plan_id, day_number, meal_type)
  }
}

Table nutrition_usermeallog {
  id int [pk, increment]
  user_id int [not null, ref: > accounts_user.id]
  meal_template_id int [not null, ref: > nutrition_mealtemplate.id]
  date date [not null]
  completed bool [default: false]
  notes text
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    (user_id, meal_template_id, date)
    date
  }
}

// ==================== CHALLENGES ====================
Table challenges_challenge {
  id int [pk, increment]
  gym_id int [null, ref: > gyms_gym.id]
  name varchar(255) [not null]
  description text
  type varchar(20) [note: "attendance, distance, workouts, nutrition, mixed"]
  start_date date [not null]
  end_date date [not null]
  reward_points int [default: 100]
  goal_value int [default: 10]
  status varchar(20) [default: "draft", note: "draft, active, completed, archived"]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    gym_id
    status
    start_date
  }
}

Table challenges_challengeparticipation {
  id int [pk, increment]
  challenge_id int [not null, ref: > challenges_challenge.id]
  user_id int [not null, ref: > accounts_user.id]
  progress int [default: 0]
  status varchar(20) [default: "joined", note: "joined, completed, dropped"]
  points_earned int [default: 0]
  last_update datetime [default: "current_timestamp"]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    (challenge_id, user_id)
    user_id
  }
}

Table challenges_badge {
  id int [pk, increment]
  gym_id int [null, ref: > gyms_gym.id]
  name varchar(120) [not null]
  description text
  icon varchar(255)
  condition varchar(255)
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    gym_id
  }
}

Table challenges_userbadge {
  id int [pk, increment]
  user_id int [not null, ref: > accounts_user.id]
  badge_id int [not null, ref: > challenges_badge.id]
  awarded_at datetime [default: "current_timestamp"]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    (user_id, badge_id)
    user_id
  }
}

Table challenges_userprogress {
  id int [pk, increment]
  user_id int [unique, not null, ref: - accounts_user.id]
  level int [default: 1]
  total_points int [default: 0]
  current_xp int [default: 0]
  next_level_xp int [default: 1000]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    user_id
  }
}

// ==================== SUBSCRIPTIONS ====================
Table subscriptions_subscriptionplan {
  id int [pk, increment]
  name varchar(100) [not null]
  description text
  price decimal(8,2) [default: 0]
  currency varchar(10) [default: "USD"]
  billing_cycle varchar(20) [note: "monthly, annual, custom"]
  user_limit int [null]
  features json
  is_active bool [default: true]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    is_active
  }
}

Table subscriptions_subscription {
  id int [pk, increment]
  owner_gym_id int [null, ref: > gyms_gym.id]
  owner_user_id int [null, ref: > accounts_user.id]
  plan_id int [not null, ref: > subscriptions_subscriptionplan.id]
  status varchar(20) [default: "active", note: "active, past_due, canceled, incomplete"]
  start_date date [not null]
  end_date date [null]
  next_billing_date date [null]
  cancel_at_period_end bool [default: false]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    owner_gym_id
    owner_user_id
    plan_id
    status
  }
}

Table subscriptions_payment {
  id int [pk, increment]
  subscription_id int [not null, ref: > subscriptions_subscription.id]
  amount decimal(8,2) [not null]
  currency varchar(10) [default: "USD"]
  status varchar(20) [default: "success", note: "success, pending, failed"]
  paid_at datetime [not null]
  provider varchar(50) [default: "manual"]
  external_id varchar(120)
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    subscription_id
    paid_at
  }
}

// ==================== GAMIFICATION ====================
Table gamification_userpoints {
  id int [pk, increment]
  user_id int [not null, ref: > accounts_user.id]
  points int [not null]
  source varchar(100)
  description text
  related_challenge_id int [null, ref: > challenges_challenge.id]
  related_nutrition_plan_id int [null, ref: > nutrition_nutritionplan.id]
  created_at datetime [default: "current_timestamp"]
  updated_at datetime [default: "current_timestamp"]
  
  indexes {
    user_id
    created_at
    related_challenge_id
    related_nutrition_plan_id
  }
}

// ==================== RELATIONSHIPS SUMMARY ====================
// User (accounts_user):
//   - Many Gyms users via gym_id
//   - Many Workout Sessions as user
//   - Many Challenge Participations
//   - Many Meal Logs
//   - Many Badges (via UserBadge)
//   - One UserProgress
//   - Many Points (via UserPoints)
//   - Many Subscriptions as owner_user
//   - Many Routines created_by

// Gym (gyms_gym):
//   - Many Users
//   - Many Branches
//   - Many Exercises
//   - Many Workout Routines
//   - Many Challenges
//   - Many Badges
//   - Many Nutrition Plans
//   - Many Subscriptions as owner_gym

// Workout Routine (workouts_workoutroutine):
//   - Many Routine Exercises
//   - Many Workout Sessions
//   - One Gym
//   - One Created By User

// Nutrition Plan (nutrition_nutritionplan):
//   - Many Meal Templates
//   - Many User Points (related_nutrition_plan_id)
//   - One Gym

// Challenge (challenges_challenge):
//   - Many Challenge Participations
//   - Many User Points (related_challenge_id)
//   - One Gym
